<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat AP Revestimentos</title>

  <!-- Font Awesome CDN para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-pMsvQ1EoY0k3gKDxgr7KiGHeTT0WTDR2D0+Xbnkz1y17XJKFmH5j8rKppM4yr5RV0NpkhPx+h3Ic3c2wrjWcNQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* Botão de chat */
    #botao-chat {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #25D366;
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      font-size: 18px;
      transition: background-color 0.3s;
    }
    #botao-chat:hover {
      background-color: #128C7E;
    }

    /* Bolha de mensagem */
    #chat-message {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background-color: #25D366;
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
      font-family: Arial, sans-serif;
      font-size: 14px;
      max-width: 200px;
      text-align: center;
    }

    /* Container do chat */
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      max-height: 400px;
      background: white;
      display: none;
      flex-direction: column;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      border-radius: 8px;
      overflow: hidden;
      font-family: Arial, sans-serif;
      z-index: 1000;
    }

    #chat-header {
      background: #25D366;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-header button {
      background: transparent;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }

    #chat-box {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
    }

    #chat-box .message {
      margin: 6px 0;
      display: flex;
    }
    #chat-box .message.bot .text {
      background-color: #f1f1f1;
      color: #333;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 80%;
    }
    #chat-box .message.user .text {
      background-color: #25D366;
      color: white;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 80%;
      margin-left: auto;
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ddd;
    }

    #input-area input {
      flex: 1;
      padding: 8px;
      border: none;
      outline: none;
      font-size: 14px;
    }

    #input-area button {
      background-color: #25D366;
      border: none;
      color: white;
      padding: 0 16px;
      cursor: pointer;
      font-size: 14px;
    }

    #whatsapp-btn {
      display: none;
      text-align: center;
      padding: 10px;
      background-color: #128C7E;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      margin: 10px;
      display: block;
    }

    .options {
      display: flex;
      flex-direction: column;
      margin-top: 6px;
    }

    .option-btn {
      background-color: #f1f1f1;
      border: none;
      padding: 6px 10px;
      margin: 2px 0;
      cursor: pointer;
      border-radius: 6px;
      font-size: 13px;
    }
    .option-btn:hover {
      background-color: #ddd;
    }
  </style>
</head>
<body>

  <!-- Botão de Chat -->
  <button id="botao-chat" aria-label="Abrir chat">
    <i class="fa-solid fa-headset"></i>
  </button>

  <!-- Bolha de mensagem -->
  <div id="chat-message">Posso te ajudar?</div>

  <!-- Container do Chat -->
  <div id="chat-container" role="dialog" aria-modal="true" aria-labelledby="chat-header-title">
    <div id="chat-header">
      <span id="chat-header-title">Chat AP Revestimentos</span>
      <button id="fechar-chat" aria-label="Fechar chat">&times;</button>
    </div>
    <div id="chat-box" aria-live="polite" aria-atomic="false"></div>
    <a id="whatsapp-btn" href="#" target="_blank" rel="noopener noreferrer">Falar no WhatsApp</a>
    <div id="input-area">
      <input type="text" id="user-input" placeholder="Digite sua pergunta aqui..." aria-label="Mensagem do usuário" />
      <button id="enviar-btn">Enviar</button>
    </div>
  </div>

  <script>
    // Seu código JavaScript do chatbot já fornecido
    const botaoChat = document.getElementById('botao-chat');
    const chatContainer = document.getElementById('chat-container');
    const fecharChat = document.getElementById('fechar-chat');
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const enviarBtn = document.getElementById('enviar-btn');
    const whatsappBtn = document.getElementById('whatsapp-btn');

    const dicionario = [
      "orçamento", "preço", "horário", "funciona",
      "produtos", "letra", "caixa", "totem", "acrílico", "contato"
    ];

    function removerAcentos(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function similaridade(str1, str2) {
      str1 = removerAcentos(str1.toLowerCase());
      str2 = removerAcentos(str2.toLowerCase());
      const len = Math.max(str1.length, str2.length);
      let iguais = 0;
      for (let i = 0; i < Math.min(str1.length, str2.length); i++) {
        if (str1[i] === str2[i]) iguais++;
      }
      return iguais / len;
    }

    function corrigirPalavra(palavra) {
      let melhor = palavra;
      let maiorScore = 0;
      dicionario.forEach(dic => {
        const score = similaridade(palavra, dic);
        if (score > maiorScore) {
          maiorScore = score;
          melhor = dic;
        }
      });
      return (maiorScore >= 0.6) ? melhor : palavra;
    }

    function normalizarMensagem(mensagem) {
      return mensagem.split(" ").map(p => corrigirPalavra(p)).join(" ");
    }

    function mostrarMensagem(texto, remetente) {
      const div = document.createElement('div');
      div.classList.add('message', remetente);
      div.innerHTML = `<div class="text">${texto}</div>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function gerarResposta(mensagem) {
      mensagem = normalizarMensagem(mensagem.toLowerCase());
      whatsappBtn.style.display = 'none';

      if(mensagem.includes("orçamento") || mensagem.includes("preço")) {
        whatsappBtn.style.display = 'block';
        whatsappBtn.href = "https://wa.me/5511950840228?text=Olá,%20gostaria%20de%20um%20orçamento%20dos%20produtos.";
        return "Para orçamento, clique no botão abaixo para falar diretamente com nosso time no WhatsApp!";
      }
      if(mensagem.includes("horário") || mensagem.includes("funciona")) {
        return "Nosso horário de atendimento é de segunda a sexta, das 8h às 18h.";
      }
      if(mensagem.includes("produtos")) {
        return "Temos Letra Caixa Inox, PVC e Acrílico. Quer saber o preço ou disponibilidade?";
      }
      if(mensagem.includes("totem")) {
        return "Os totens disponíveis são Totem de Fachada e Mini Totem Iluminado.";
      }
      if(mensagem.includes("acrílico")) {
        return "Letra Acrílica colorida e iluminada, ideal para ambientes internos.";
      }
      if(mensagem.includes("contato")) {
        whatsappBtn.style.display = 'block';
        whatsappBtn.href = "https://wa.me/5511950840228?text=Olá,%20gostaria%20de%20mais%20informações%20sobre%20contato.";
        return "Você pode falar conosco pelo WhatsApp clicando no botão abaixo.";
      }
      return "Desculpe, não entendi sua pergunta. Pode tentar reformular?";
    }

    function mostrarOpcoes(opcoes) {
      const div = document.createElement('div');
      div.classList.add('options');
      opcoes.forEach(op => {
        const btn = document.createElement('button');
        btn.classList.add('option-btn');
        btn.textContent = op;
        btn.onclick = () => {
          mostrarMensagem(op, 'user');
          const respostaBot = gerarResposta(op);
          setTimeout(() => mostrarMensagem(respostaBot, 'bot'), 600);
          div.remove();
        };
        div.appendChild(btn);
      });
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function enviarMensagem() {
      const textoUsuario = userInput.value.trim();
      if(!textoUsuario) return;
      mostrarMensagem(textoUsuario, 'user');
      const respostaBot = gerarResposta(textoUsuario);
      setTimeout(() => mostrarMensagem(respostaBot, 'bot'), 600);
      userInput.value = '';
      userInput.focus();
    }

    enviarBtn.addEventListener('click', enviarMensagem);
    userInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter') enviarMensagem();
    });

    botaoChat.addEventListener('click', () => {
      chatContainer.style.display = 'flex';
      botaoChat.style.display = 'none';
      userInput.focus();
      setTimeout(() => {
        mostrarMensagem("Olá! Selecione uma das opções ou digite sua dúvida:", 'bot');
        mostrarOpcoes([
          "Quero um orçamento",
          "Qual horário de atendimento?",
          "Quais produtos vocês têm?",
          "Contato"
        ]);
      }, 100);
    });

    fecharChat.addEventListener('click', () => {
      chatContainer.style.display = 'none';
      botaoChat.style.display = 'flex';
      chatBox.innerHTML = '';
      whatsappBtn.style.display = 'none';
    });

    // Bolha "Posso te ajudar?"
    window.addEventListener('load', () => {
      const mensagem = document.getElementById('chat-message');
      setTimeout(() => {
        mensagem.style.opacity = "1";
        mensagem.style.transform = "translateY(0)";
      }, 500);
      setTimeout(() => {
        mensagem.style.opacity = "0";
        mensagem.style.transform = "translateY(20px)";
      }, 5500);
    });
  </script>

</body>
</html>
